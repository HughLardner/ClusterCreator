---
# Pi-hole Helm Chart Values
# https://github.com/MoJo2600/pihole-kubernetes

# Pi-hole environment variables
# Admin password should be set via Kubernetes Secret or SealedSecret
env:
  TZ: "UTC"
  WEBPASSWORD: "" # Set via secret or SealedSecret - leave empty to use auto-generated

# DNS upstream servers
dns:
  upstream:
    - "1.1.1.1"
    - "1.0.0.1"

# Web service configuration
serviceWeb:
  type: ClusterIP
  annotations: {}

# DNS service configuration
# Pi-hole DNS needs to be accessible on port 53
# Using LoadBalancer with MetalLB to get a dedicated IP address
serviceDns:
  mixedService: true # Combine TCP and UDP into a single service
  type: LoadBalancer
  port: 53
  annotations:
    metallb.io/ip-allocated-from-pool: metallb-ipaddresspool
  # Enforce a specific IP address for Pi-hole DNS
  # This ensures Pi-hole always gets the same IP, making DNS configuration stable
  loadBalancerIP: "192.168.10.150"
  # Use Cluster externalTrafficPolicy to allow traffic to any node
  # Local policy requires pod to be on the receiving node, which can cause connectivity issues
  externalTrafficPolicy: Cluster

# Ingress configuration for Traefik
ingress:
  enabled: true
  ingressClassName: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod
  path: /
  pathType: ImplementationSpecific
  hosts:
    - pihole.local
  tls:
    - secretName: pihole-tls
      hosts:
        - pihole.local

# Persistent volume configuration
persistentVolumeClaim:
  enabled: true
  storageClass: longhorn
  accessModes:
    - ReadWriteOnce
  size: 10Gi

# Resources
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"
